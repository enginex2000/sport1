<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Esplanade Sport Club</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

  <!-- SweetAlert2 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    const bookedDict = {{ booked_dict|tojson }};
    const maintenanceStatus = {{ 'true' if maintenance else 'false' }};
  </script>
  <script src="{{ url_for('static', filename='script.js') }}"></script>
</head>
<body>

<div class="container user-container">
  <h1>Esplanade Sport Club</h1>
  <h2>ใส่ข้อมูลของคุณ</h2>

  <form method="post" action="/process" id="bookingForm">
    <label>Booking Date</label>
    <input type="date" id="datePicker" name="date" value="{{ today }}" min="{{ today }}" required>

    <label>Courts</label>
    <select id="courts" name="courts">
      <option value="Badminton C1">Badminton C1</option>
      <option value="Table Tennis C2">Table Tennis C2</option>
    </select>

    <label>Times</label>
    <select id="times" name="times">
      <option value="10.00" data-label="10.00-12.00">10.00-12.00</option>
      <option value="12.00" data-label="12.00-14.00">12.00-14.00</option>
      <option value="14.00" data-label="14.00-16.00">14.00-16.00</option>
      <option value="16.00" data-label="16.00-18.00">16.00-18.00</option>
      <option value="18.00" data-label="18.00-20.00">18.00-20.00</option>
      <option value="20.00" data-label="20.00-22.00">20.00-22.00</option>
    </select>

    <label>Name</label>
    <input type="text" name="name" placeholder="ใส่ชื่อของคุณ..." required>

    <label>Phone</label>
    <input type="text" name="phone" placeholder="หมายเลขโทรศัพท์..." 
           pattern="[0-9]{10}" maxlength="10" 
           title="กรุณากรอกหมายเลขโทรศัพท์ 10 หลัก" required>

    <button type="submit">จอง</button>
  </form>
</div>

<script>
  window.onload = function() {
      updateTimes(bookedDict, maintenanceStatus);
  }

  document.getElementById("courts").addEventListener("change", function() {
      updateTimes(bookedDict, maintenanceStatus);
  });
  document.getElementById("datePicker").addEventListener("change", function() {
      updateTimes(bookedDict, maintenanceStatus);
  });

  // แสดงรายละเอียดการจองหลังผู้ใช้กดจอง
  document.getElementById("bookingForm").addEventListener("submit", function(e) {
      e.preventDefault(); // กันไม่ให้ส่งทันที

      const date = document.getElementById("datePicker").value;
      const courts = document.getElementById("courts").value;
      const times = document.getElementById("times");
      const timesText = times.options[times.selectedIndex].getAttribute("data-label") || times.value;
      const name = this.querySelector("input[name='name']").value;
      const phone = this.querySelector("input[name='phone']").value;

      Swal.fire({
          title: 'รายละเอียดการจอง',
          html: `
              <p><b>ชื่อ:</b> ${name}</p>
              <p><b>เบอร์โทร:</b> ${phone}</p>
              <p><b>สนาม:</b> ${courts}</p>
              <p><b>เวลา:</b> ${timesText}</p>
              <p><b>วันที่:</b> ${date}</p>
          `,
          icon: 'info',
          confirmButtonText: 'ตกลง',
          allowOutsideClick: false,
          allowEscapeKey: false
      }).then(() => {
          this.submit(); // ส่งฟอร์มจริงหลังปิด popup
      });
  });
</script>

</body>
</html>
